<!DOCTYPE html>
<html>
<head>
  <title>Hello World - Cloudflare Pages Example</title>
</head>
<body>
  <h1 id="title">Test</h1> 
  <p id="description"></p> <!-- This will be populated with description from JSON -->
  <img id="image-url"> <!-- This will be populated with image URL from JSON -->
  <img id="myImage" src="" alt="Million Ether Pixels" />

  <script>

    // myKey is hardcoded in this file. See Readme)
    let MY_KEY = "goerli-preview" 

    // e.g. https://kv-value-retriever.porobov-p3798.workers.dev/?myKey=goerli-preview
    const WORKER_URL = "https://kv-value-retriever.porobov-p3798.workers.dev"
    // const WORKER_URL = "http://localhost:8787"

    const fetchURL = WORKER_URL + "?myKey=" + MY_KEY
    fetch(fetchURL)
      .then(response => response.json())
      .then(rawData => {
        // must parse JSON here! It lays in a stringified format in KV storage
        // worker does not make any changes to it.
        const data = JSON.parse(rawData)
        if (data.error) {
          console.log(data.error)
        } else {
          const base64Image = data.adsSnapshot.bigPicBinary.toString('base64')
          // const title = document.getElementById("title");
          const imgElement = document.getElementById('myImage');
          imgElement.src = `data:image/jpeg;base64,${base64Image}`
        }
      })
      .catch(error => {
        console.error("Failed to fetch JSON data. Error: ", error);
      });
  </script>
</body>
</html>
